/*
---------------------------------------------------------------------------------------
Github project: https://github.com/ziyan/javascript-rsa
Relies on jsbn library from Tom Wu: http://www-cs-students.stanford.edu/~tjw/jsbn/
---------------------------------------------------------------------------------------
*/

var RSAPublicKey=function(e,t){this.modulus=new BigInteger(Hex.encode(e),16);this.encryptionExponent=new BigInteger(Hex.encode(t),16)};var UTF8={encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},decode:function(e){var t="";var n=0;var r=$c1=$c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){$c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|$c2&63);n+=2}else{$c2=e.charCodeAt(n+1);$c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|($c2&63)<<6|$c3&63);n+=3}}return t}};var Base64={base64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){if(!e){return false}var t="";var n,r,i;var s,o,u,a;var f=0;do{n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r))u=a=64;else if(isNaN(i))a=64;t+=this.base64.charAt(s)+this.base64.charAt(o)+this.base64.charAt(u)+this.base64.charAt(a)}while(f<e.length);return t},decode:function(e){if(!e)return false;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var t="";var n,r,i,s;var o=0;do{n=this.base64.indexOf(e.charAt(o++));r=this.base64.indexOf(e.charAt(o++));i=this.base64.indexOf(e.charAt(o++));s=this.base64.indexOf(e.charAt(o++));t+=String.fromCharCode(n<<2|r>>4);if(i!=64)t+=String.fromCharCode((r&15)<<4|i>>2);if(s!=64)t+=String.fromCharCode((i&3)<<6|s)}while(o<e.length);return t}};var Hex={hex:"0123456789abcdef",encode:function(e){if(!e)return false;var t="";var n;var r=0;do{n=e.charCodeAt(r++);t+=this.hex.charAt(n>>4&15)+this.hex.charAt(n&15)}while(r<e.length);return t},decode:function(e){if(!e)return false;e=e.replace(/[^0-9abcdef]/g,"");var t="";var n=0;do{t+=String.fromCharCode(this.hex.indexOf(e.charAt(n++))<<4&240|this.hex.indexOf(e.charAt(n++))&15)}while(n<e.length);return t}};var ASN1Data=function(e){this.error=false;this.parse=function(e){if(!e){this.error=true;return null}var t=[];while(e.length>0){var n=e.charCodeAt(0);e=e.substr(1);var r=0;if((n&31)==5)e=e.substr(1);else{if(e.charCodeAt(0)&128){var i=e.charCodeAt(0)&127;e=e.substr(1);if(i>0)r=e.charCodeAt(0);if(i>1)r=r<<8|e.charCodeAt(1);if(i>2){this.error=true;return null}e=e.substr(i)}else{r=e.charCodeAt(0);e=e.substr(1)}}var s="";if(r){if(r>e.length){this.error=true;return null}s=e.substr(0,r);e=e.substr(r)}if(n&32)t.push(this.parse(s));else t.push(this.value(n&128?4:n&31,s))}return t};this.value=function(e,t){if(e==1)return t?true:false;else if(e==2)return t;else if(e==3)return this.parse(t.substr(1));else if(e==5)return null;else if(e==6){var n=[];var r=t.charCodeAt(0);n.push(Math.floor(r/40));n.push(r-n[0]*40);var i=[];var s=0;var o;for(o=1;o<t.length;o++){var u=t.charCodeAt(o);i.push(u&127);if(u&128)s++;else{var a;var f=0;for(a=0;a<i.length;a++)f+=i[a]*Math.pow(128,s--);n.push(f);s=0;i=[]}}return n.join(".")}return null};this.data=this.parse(e)};var RSA={getPublicKey:function(e){if(e.length<50)return false;if(e.substr(0,26)!="-----BEGIN PUBLIC KEY-----")return false;e=e.substr(26);if(e.substr(e.length-24)!="-----END PUBLIC KEY-----")return false;e=e.substr(0,e.length-24);e=new ASN1Data(Base64.decode(e));if(e.error)return false;e=e.data;if(e[0][0][0]=="1.2.840.113549.1.1.1")return new RSAPublicKey(e[0][1][0][0],e[0][1][0][1]);return false},encrypt:function(e,t){if(!t)return false;var n=t.modulus.bitLength()+7>>3;e=this.pkcs1pad2(e,n);if(!e)return false;e=e.modPowInt(t.encryptionExponent,t.modulus);if(!e)return false;e=e.toString(16);while(e.length<n*2)e="0"+e;return Base64.encode(Hex.decode(e))},pkcs1pad2:function(e,t){if(t<e.length+11)return null;var n=[];var r=e.length-1;while(r>=0&&t>0)n[--t]=e.charCodeAt(r--);n[--t]=0;while(t>2)n[--t]=Math.floor(Math.random()*254)+1;n[--t]=2;n[--t]=0;return new BigInteger(n)}}